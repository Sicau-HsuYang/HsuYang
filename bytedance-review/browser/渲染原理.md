### 1. **用户输入 URL 并按下回车**

- 用户在浏览器地址栏中输入一个 URL 并按下回车。此时，浏览器开始处理这个输入，判断用户输入的是搜索关键词还是有效的 URL。如果是有效的 URL，浏览器将开始请求流程。

### 2. **DNS 解析**

- **本地缓存检查**：浏览器首先会检查本地的 DNS 缓存，查看是否已经缓存了该域名对应的 IP 地址。
- **操作系统缓存**：如果浏览器缓存中没有，浏览器会查询操作系统的 DNS 缓存。
- **路由器/ISP 缓存**：如果操作系统缓存中也没有，操作系统会向配置的 DNS 服务器（通常是路由器或 ISP 的 DNS 服务器）查询该域名的 IP 地址。
- **递归查询**：如果 DNS 服务器缓存中也没有命中，它会从根域名服务器开始，递归地查询顶级域名服务器（TLD）、权威域名服务器，直到找到目标域名的 IP 地址。
- **结果返回**：最终得到域名对应的 IP 地址，并将其返回给浏览器。

### 3. **检查本地缓存**

- **强缓存检查**：在 DNS 解析之后，浏览器在发送请求之前会检查本地缓存。如果请求的资源在缓存中且未过期（例如，`Cache-Control: max-age` 或 `Expires` 指令没有过期），浏览器会直接使用缓存中的资源，不与服务器建立连接，省去请求过程。

### 4. **TCP 连接的建立**

- **三次握手**：如果没有命中强缓存，浏览器会与服务器建立 TCP 连接。TCP 连接通过三次握手完成：
  1.  客户端发送 SYN 包到服务器。
  2.  服务器响应 SYN-ACK 包。
  3.  客户端再发送 ACK 包，连接建立。
- **TLS 握手（如果是 HTTPS）**：在 TCP 连接建立后，如果使用 HTTPS，接下来会进行 TLS 握手，客户端和服务器交换加密密钥，确保数据传输的安全性。

### 5. **发送 HTTP 请求**

- **构建 HTTP 请求**：TCP 连接建立后，浏览器构建 HTTP 请求，包括请求行、请求头（如 User-Agent, Accept-Encoding, Cookie 等）和可选的请求体。
- **发送请求**：浏览器通过 TCP 连接将 HTTP 请求发送到服务器。

### 6. **服务器响应**

- **接收请求**：服务器接收到请求后，会根据 URL 路径找到对应的资源，可能需要访问文件系统、数据库，或调用应用程序逻辑来生成响应内容。
- **协商缓存检查**：如果浏览器发送了与缓存相关的头部（如`If-Modified-Since` 或 `If-None-Match`），服务器会检查资源是否被修改。如果没有修改，返回 `304 Not Modified` 响应，浏览器从缓存中使用资源。
- **返回响应**：如果资源已更新或没有缓存，服务器返回 `200 OK` 响应，并在响应体中附带资源内容（如 HTML、CSS、JS 等），同时设置适当的缓存头部。

### 7. **浏览器接收响应**

- **解析响应头**：浏览器首先解析响应头，根据头部信息处理缓存、编码等。
- **解码内容**：如果响应体内容是压缩的（如 gzip），浏览器会根据`Content-Encoding`头进行解压缩。
- **处理响应内容**：浏览器将响应体内容送到相应的处理器中（如 HTML、CSS、JS 引擎）。

### 8. **浏览器渲染过程**

- **构建 DOM 树**：浏览器解析 HTML 文档，生成 DOM 树，代表文档的结构和内容。
- **构建 CSSOM 树**：浏览器同时解析 CSS，生成 CSSOM 树，表示样式信息。
- **合成渲染树**：浏览器将 DOM 树和 CSSOM 树合并，生成渲染树（Render Tree）。渲染树包括每个可见元素的布局和样式信息。
- **布局（Layout）**：浏览器根据渲染树计算每个元素的位置和大小。这一步有时也叫"回流"。
- **绘制（Paint）**：浏览器根据布局信息将每个元素绘制到屏幕上，涉及到颜色、边框、阴影等视觉效果的应用。
- **JS 执行和事件绑定**：在解析 HTML 的过程中，如果遇到`<script>`标签，浏览器会暂停 DOM 构建，执行 JavaScript 代码（可能包括对 DOM 的操作），然后恢复 DOM 解析。JavaScript 可能会引发回流或重绘（repaint）。

### 9. **显示页面和交互**

- **页面显示**：在上述步骤完成后，页面会被完全呈现给用户。
- **事件循环**：浏览器进入事件循环，处理用户的输入（如点击、键盘事件）和异步操作（如 setTimeout, AJAX 请求等）。

### 10. **后续资源加载**

- **异步资源加载**：页面可能包含异步加载的资源，如图片、iframe、额外的 JS 文件，这些资源的加载和执行可能会继续影响页面的显示或交互性能。

构建 CSSOM（CSS Object Model）的过程中**不会**阻塞 DOM 的解析，但会**阻塞渲染**（Render Tree 的构建），这意味着页面的内容在样式加载和解析完成之前是无法显示的。

### 具体解析：

1. **DOM 解析和 CSSOM 解析是并行的**：

   - 浏览器在解析 HTML 文档时会同时开始下载和解析 CSS 文件。这两个过程是并行的。也就是说，浏览器可以在继续解析 HTML 并构建 DOM 的同时下载和解析 CSS 文件，构建 CSSOM。

2. **CSSOM 的构建阻塞了 Render Tree 的构建**：

   - 渲染树（Render Tree）是 DOM 和 CSSOM 的结合体，用于表示页面的布局和样式。当浏览器开始构建 Render Tree 时，它需要确保所有的样式信息已经完全加载和解析，因为这些样式信息会影响元素的布局和显示。
   - 如果 CSSOM 尚未完成构建，浏览器无法确定元素的样式，因此也就无法构建渲染树，也就无法显示任何内容。这就是为什么 CSS 文件的加载和解析会阻塞页面的渲染。

3. **JavaScript 和 CSSOM 的关系**：
   - 当浏览器遇到一个 JavaScript `<script>` 标签时，通常会暂停 DOM 解析并执行脚本（除非使用 `async` 或 `defer` 属性）。如果这个脚本依赖于 CSSOM（例如脚本中使用了 `getComputedStyle` 或者依赖于 DOM 的布局信息），那么浏览器会等待 CSSOM 构建完成后再执行 JavaScript。
   - 这进一步延迟了页面的渲染，因为不仅要等 CSSOM 构建完成，还要等 JavaScript 执行完毕。

### 优化策略：

为了避免 CSS 阻塞渲染，你可以采取以下策略：

- **CSS 放在头部**：将 CSS 文件放在 HTML 文档的`<head>`中，这样浏览器可以在解析 HTML 的同时尽早开始加载和解析 CSS。
- **减少 CSS 文件的大小**：通过压缩和合并 CSS 文件，减少 CSS 加载的时间。
- **避免使用@import**：`@import` 会延迟 CSS 的加载，建议直接使用`<link>`标签引入 CSS 文件。
- **使用媒体查询**：对于不需要立即加载的 CSS，可以使用媒体查询（如 `media="print"`）来延迟这些样式的加载，减少阻塞时间。

### 小结：

- **CSSOM 的构建不会阻塞 DOM 的解析**，但它会阻塞页面的渲染，直到 Render Tree 能够被构建完成。
- 这是因为浏览器在渲染页面时需要知道所有元素的样式和布局，而这些信息依赖于 CSSOM 的完整性。
- 通过合理组织和优化 CSS，可以减少 CSS 阻塞渲染的时间，从而提高页面加载和渲染的性能。
